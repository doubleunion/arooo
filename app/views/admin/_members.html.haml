%table.table.table-striped.admin-console.js-datatable
  %thead
    %tr
      %th Name
      %th Status
      %th Scholarship?
      %th.min-width-150 Dues Paid On
      %th Notes
      %th Manage Status
  %tbody
    - users.each do |user|
      %tr
        %td.max-width-150
          - if user.name.present?
            = link_to user.name, members_user_path(user)
        %td= user.display_state
        %td= user.is_scholarship
        %td= user.last_stripe_charge_succeeded.strftime('%b %d %Y') if user.last_stripe_charge_succeeded
        %td
          = form_for :user, url: admin_save_membership_note_path, remote: true, html: { class: "js-membership-note js-membership-note-#{user.id}" } do |f|
            = f.hidden_field :id, value: user.id
            = f.text_area :membership_note, rows: 4, cols: 30, value: user.membership_note
            .submit
              = f.submit "Save Note", class: "btn"
              %span.collapse{class: "save-success-#{user.id}"} Note saved!
              %span.collapse{class: "save-failure-#{user.id}"} Note not saved :(

        %td.buttons
          = form_for user, url: admin_revoke_membership_path do |f|
            = f.hidden_field(:id)
            = f.submit "Revoke DU Membership", class: "btn reject-btn", data: { confirm: "Are you sure?" }
          - if user.voting_member?
            = form_for user, url: admin_revoke_voting_member_path do |f|
              = f.hidden_field(:id)
              = f.submit "Revoke Voting membership", class: "btn reject-btn", data: { confirm: "Are you sure?" }
          - elsif user.key_member?
            = form_for user, url: admin_revoke_key_member_path do |f|
              = f.hidden_field(:id)
              = f.submit "Revoke Key membership", class: "btn reject-btn", data: { confirm: "Are you sure?" }
            = form_for user, url: admin_add_voting_member_path do |f|
              = f.hidden_field(:id)
              = f.submit "Make Voting member", class: "btn accept-btn", data: { confirm: "Are you sure?" }
          - else
            = form_for user, url: admin_add_key_member_path do |f|
              = f.hidden_field(:id)
              = f.submit "Make Key member", class: "btn accept-btn", data: { confirm: "Are you sure?" }
